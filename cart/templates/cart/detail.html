{% extends "shop/base.html" %}
{% block content %}
  {% if cart|length == 0 %}
    <h1 style="margin-top: 10px;">Your Cart is empty</h1>
  {% else %}
  <table class="table table-hover table-bordered text-center my_cart">
      <thead>
        <tr>
          <th>Зображення</th>
          <th>Назва продукту</th>
          <th>Кількість для оновлення</th>
          <th>Кількість</th>
          <th>Ціна за штуку, грн</th>

          <th>Сума, грн</th>
            <th>Видалити продукт</th>
        </tr>
      </thead>
      <tbody>
      <div class="NewCart">
        {% for item in cart %}
          {% with product=item.product %}
          {% load static %}
            <tr
                    class="product"
                actionUrl="{% url 'cart:cart_remove' product.id %}"
                actionUrl2="{% url 'cart:cart_add' product.id %}"
            >
              <td>
                  <a href="{{ product.get_absolute_url }}">
                      <img class="cart_shopimg" src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'shop/check.png' %}{% endif %}">
                  </a>
              </td>
              <td>{{ product.title }}</td>
              <td>
                <form action="{% url 'cart:cart_add' product.id %}" method="post" class="update_form" id="update_form">
                  {{ item.update_quantity_form.quantity }}
                  <p>{{ item.update_quantity_form.update }}</p>
                  <button type="submit" id="update_button">
                      <svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 30 30" width="30px" height="30px">
                      <path d="M 15 3 C 12.031398 3 9.3028202 4.0834384 7.2070312 5.875 A 1.0001 1.0001 0 1 0 8.5058594 7.3945312 C 10.25407 5.9000929 12.516602 5 15 5 C 20.19656 5 24.450989 8.9379267 24.951172 14 L 22 14 L 26 20 L 30 14 L 26.949219 14 C 26.437925 7.8516588 21.277839 3 15 3 z M 4 10 L 0 16 L 3.0507812 16 C 3.562075 22.148341 8.7221607 27 15 27 C 17.968602 27 20.69718 25.916562 22.792969 24.125 A 1.0001 1.0001 0 1 0 21.494141 22.605469 C 19.74593 24.099907 17.483398 25 15 25 C 9.80344 25 5.5490109 21.062074 5.0488281 16 L 8 16 L 4 10 z"/></svg>
                  </button>
                  {% csrf_token %}
                </form>
              </td>
              <td>
                  {{ item.quantity }}
              </td>
              <td class="num">{{ item.price }}</td>
              <td class="num">{{ item.total_price }}</td>
                <td><a style="text-decoration: none; font-size: small;" id="cart_remove" href="#">&#10060;</a></td>
            </tr>
            {% endwith %}
      {% endfor %}

      </div>
      <tr class="total">
        <td style="font-weight: bold; font-size: large;">Загальна сума</td>
        <td colspan="4"></td>
        <td class="num">{{ cart.get_total_price }}</td>
      </tr>
      </tbody>
  </table>
  <p class="text-right">
    <a href="{% url 'shop' %}" style="text-decoration: none;">
      <input type="submit" class="btn btn-warning" value="До магазину">
    </a>
    <a href="#" style="margin-left: 9px;">
      <input type="submit" class="btn btn-success" style="margin-left: 10px;" value="Оформити заказ" onclick="/#/">
    </a>
  </p>
    <script>
              const mainLayout = document.querySelector('main');
              const productLayout = document.querySelector('.table');
              const productLayout2 = document.querySelector('.btn-warning');
              const productLayout3 = document.querySelector('.btn-success');
              const products = document.querySelectorAll('.product');

              for (let i = 0; i < products.length; i++) {
                  products[i].querySelector('#cart_remove').addEventListener('click', () => {
                      $.ajax({
                           type: 'POST',
                           data: {'csrfmiddlewaretoken':$('[name=csrfmiddlewaretoken]').val()},
                           url: products[i].getAttribute('actionUrl'),
                           success: function(response){
                                products[i].remove();
                                console.log(productLayout2);
                                if (response.data === "Vitya") {
                                    productLayout.remove();
                                    productLayout2.remove();
                                    productLayout3.remove();
                                    mainLayout.insertAdjacentHTML('afterbegin', "<h1 style='color: black; margin-top: 40px; margin-left: 40px;'> Your cart is empty </h1>");
                                }
                            }
                      })
                  })
              }



          </script>
{% endif %}
{% endblock %}


